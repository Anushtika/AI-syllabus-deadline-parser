<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Syllabus Deadline Parser</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        function App() {
            const [syllabusText, setSyllabusText] = React.useState('');
            const [deadlines, setDeadlines] = React.useState([]);
            const [loading, setLoading] = React.useState(false);
            const [error, setError] = React.useState('');
            const [apiKey, setApiKey] = React.useState('');
            const [showSettings, setShowSettings] = React.useState(false);

            React.useEffect(() => {
                const saved = localStorage.getItem('gemini_api_key');
                if (saved) setApiKey(saved);
                
                const savedDeadlines = localStorage.getItem('deadlines');
                if (savedDeadlines) {
                    try {
                        setDeadlines(JSON.parse(savedDeadlines));
                    } catch (e) {
                        console.log('No saved deadlines');
                    }
                }
            }, []);

            const saveApiKey = () => {
                if (apiKey.trim()) {
                    localStorage.setItem('gemini_api_key', apiKey);
                    setShowSettings(false);
                    setError('');
                    alert('âœ“ API key saved successfully!');
                }
            };

            const parseWithAI = async () => {
                if (!syllabusText.trim()) {
                    setError('Please paste your syllabus text!');
                    return;
                }
                if (!apiKey.trim()) {
                    setError('Please add your Gemini API key in settings!');
                    setShowSettings(true);
                    return;
                }

                setLoading(true);
                setError('');

                const prompt = `Extract all deadlines from this syllabus and return ONLY a JSON array. No markdown, no explanation.

SYLLABUS:
${syllabusText}

Format:
[
  {"title": "Assignment 1", "date": "2026-01-25", "type": "assignment", "description": "Details"}
]

Types: assignment, exam, quiz, project, presentation, deadline
Date format: YYYY-MM-DD (assume 2026 if year missing)`;

                try {
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                generationConfig: { temperature: 0.2, maxOutputTokens: 2000 }
                            })
                        }
                    );

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || 'API request failed');
                    }

                    const data = await response.json();
                    let text = data.candidates[0].content.parts[0].text;
                    text = text.replace(/```json/g, '').replace(/```/g, '').trim();
                    
                    const parsed = JSON.parse(text);
                    parsed.sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    setDeadlines(parsed);
                    localStorage.setItem('deadlines', JSON.stringify(parsed));
                    
                } catch (err) {
                    console.error('Error:', err);
                    if (err.message.includes('API_KEY') || err.message.includes('API key')) {
                        setError('Invalid API key. Please check and try again.');
                        setShowSettings(true);
                    } else {
                        setError('Error: ' + err.message);
                    }
                } finally {
                    setLoading(false);
                }
            };

            const clearAll = () => {
                setDeadlines([]);
                setSyllabusText('');
                localStorage.removeItem('deadlines');
            };

            const exportToCalendar = () => {
                let ics = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Syllabus Parser//EN\n';
                
                deadlines.forEach((d, i) => {
                    const date = new Date(d.date);
                    const dateStr = date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                    ics += `BEGIN:VEVENT\nUID:deadline-${i}\nDTSTART:${dateStr}\nSUMMARY:${d.title}\nEND:VEVENT\n`;
                });
                
                ics += 'END:VCALENDAR';
                
                const blob = new Blob([ics], { type: 'text/calendar' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'deadlines.ics';
                a.click();
                URL.revokeObjectURL(url);
            };

            const getDaysUntil = (dateStr) => {
                const deadline = new Date(dateStr);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                deadline.setHours(0, 0, 0, 0);
                const diff = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                
                if (diff < 0) return { text: 'Overdue', color: 'text-red-600' };
                if (diff === 0) return { text: 'Today!', color: 'text-red-600 font-bold' };
                if (diff <= 7) return { text: `${diff} days`, color: 'text-orange-600' };
                return { text: `${diff} days`, color: 'text-gray-600' };
            };

            const getTypeColor = (type) => {
                const colors = {
                    assignment: 'bg-blue-100 text-blue-700',
                    exam: 'bg-red-100 text-red-700',
                    quiz: 'bg-yellow-100 text-yellow-700',
                    project: 'bg-purple-100 text-purple-700',
                    presentation: 'bg-green-100 text-green-700',
                    deadline: 'bg-orange-100 text-orange-700'
                };
                return colors[type] || 'bg-gray-100 text-gray-700';
            };

            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 p-6' },
                React.createElement('div', { className: 'max-w-5xl mx-auto' },
                    
                    // Header Section
                    React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-8 mb-6' },
                        React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                            React.createElement('div', null,
                                React.createElement('h1', { className: 'text-3xl font-bold text-gray-800 mb-2' }, 
                                    'ðŸŽ“ AI Syllabus Deadline Parser'
                                ),
                                React.createElement('p', { className: 'text-gray-600' }, 
                                    'Powered by Google Gemini AI'
                                )
                            ),
                            React.createElement('button', {
                                onClick: () => setShowSettings(!showSettings),
                                className: 'px-6 py-3 bg-indigo-100 text-indigo-700 rounded-xl hover:bg-indigo-200 font-semibold'
                            }, 'âš™ï¸ Settings')
                        ),

                        // API Settings
                        showSettings && React.createElement('div', { className: 'mb-6 p-6 bg-blue-50 border-2 border-blue-200 rounded-xl' },
                            React.createElement('h3', { className: 'font-bold text-gray-800 mb-3' }, 'ðŸ”‘ Gemini API Key'),
                            React.createElement('p', { className: 'text-sm text-gray-600 mb-3' },
                                'Get your free API key from ',
                                React.createElement('a', {
                                    href: 'https://makersuite.google.com/app/apikey',
                                    target: '_blank',
                                    rel: 'noopener noreferrer',
                                    className: 'text-blue-600 underline font-medium'
                                }, 'Google AI Studio â†’')
                            ),
                            React.createElement('div', { className: 'flex gap-3' },
                                React.createElement('input', {
                                    type: 'password',
                                    value: apiKey,
                                    onChange: (e) => setApiKey(e.target.value),
                                    placeholder: 'AIza...',
                                    className: 'flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none'
                                }),
                                React.createElement('button', {
                                    onClick: saveApiKey,
                                    className: 'px-8 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold'
                                }, 'Save')
                            ),
                            apiKey && React.createElement('p', { className: 'text-xs text-green-600 mt-2' }, 'âœ“ API key saved locally')
                        ),

                        // Textarea
                        React.createElement('textarea', {
                            value: syllabusText,
                            onChange: (e) => setSyllabusText(e.target.value),
                            placeholder: 'Paste your course syllabus here...\n\nExample:\nWeek 1 (Jan 15): Introduction\nAssignment 1 due Jan 22: Essay\nMidterm Exam on Feb 15\nFinal Project due March 30',
                            className: 'w-full h-64 p-4 border-2 border-gray-300 rounded-xl mb-4 focus:border-indigo-500 focus:outline-none font-mono text-sm'
                        }),

                        // Error Message
                        error && React.createElement('div', { 
                            className: error.includes('âœ“') ? 'p-4 rounded-lg mb-4 bg-green-50 text-green-700' : 'p-4 rounded-lg mb-4 bg-red-50 text-red-700'
                        }, error),

                        // Parse Button
                        React.createElement('button', {
                            onClick: parseWithAI,
                            disabled: loading,
                            className: 'w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:from-indigo-600 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed'
                        }, loading ? 'â³ Parsing with AI...' : 'âœ¨ Extract Deadlines with AI')
                    ),

                    // Results Section
                    deadlines.length > 0 && React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-8' },
                        React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-gray-800' },
                                `ðŸ“… Found ${deadlines.length} Deadline${deadlines.length !== 1 ? 's' : ''}`
                            ),
                            React.createElement('div', { className: 'flex gap-3' },
                                React.createElement('button', {
                                    onClick: exportToCalendar,
                                    className: 'px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold'
                                }, 'ðŸ“¥ Export'),
                                React.createElement('button', {
                                    onClick: clearAll,
                                    className: 'px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 font-semibold'
                                }, 'ðŸ—‘ï¸ Clear')
                            )
                        ),

                        React.createElement('div', { className: 'space-y-4' },
                            deadlines.map((deadline, index) => {
                                const daysUntil = getDaysUntil(deadline.date);
                                const date = new Date(deadline.date);
                                const formatted = date.toLocaleDateString('en-US', {
                                    weekday: 'short',
                                    year: 'numeric',
                                    month: 'short',
                                    day: 'numeric'
                                });

                                return React.createElement('div', {
                                    key: index,
                                    className: 'border-2 border-gray-200 rounded-xl p-5 hover:shadow-md transition-shadow'
                                },
                                    React.createElement('div', { className: 'flex items-start justify-between' },
                                        React.createElement('div', { className: 'flex-1' },
                                            React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                                                React.createElement('span', { 
                                                    className: `px-3 py-1 ${getTypeColor(deadline.type)} rounded-full text-xs font-bold uppercase`
                                                }, deadline.type),
                                                React.createElement('span', { className: `text-sm font-bold ${daysUntil.color}` }, daysUntil.text)
                                            ),
                                            React.createElement('h3', { className: 'text-lg font-bold text-gray-800 mb-1' }, deadline.title),
                                            React.createElement('p', { className: 'text-gray-600 text-sm mb-2' }, `ðŸ“… ${formatted}`),
                                            deadline.description && React.createElement('p', { className: 'text-gray-600 text-sm' }, deadline.description)
                                        )
                                    )
                                );
                            })
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
